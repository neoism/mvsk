#!/usr/bin/env ruby
require 'mercenary'
require 'papago'

Mercenary.program(:papago) do |program|
  program.version Papago::VERSION
  program.syntax 'papago <text> [options]'

  program.option 'switch', '-s', '--switch', 'Select a service'
  program.option 'input', '-i', '--input PATH', String, 'Set file path'
  program.option 'dest', '--dest IDENT', String, 'Set target language'

  program.action do |args, options|
    if options['switch']
      Papago::Actions::Switch
        .process(config: Papago.config)
    else
      text = args.join(' ').strip
      path = options['input']

      if path and File.file?(path)
        text = File.read(path)
          .gsub(/\n/, ' ')
          .strip
      end

      if text.empty?
        puts 'No content'
      else
        Papago::Actions::Run
          .process(text: text, dest: options['dest'])
      end
    end
  end
end
